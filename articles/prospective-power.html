<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Prospective Power Estimation • postcard</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Prospective Power Estimation">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">postcard</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/postcard.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/model-fit.html">Controlling behavior of model fitting functions</a></li>
    <li><a class="dropdown-item" href="../articles/prospective-power.html">Prospective Power Estimation</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/NovoNordisk-OpenSource/postcard/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Prospective Power Estimation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/NovoNordisk-OpenSource/postcard/blob/main/vignettes/prospective-power.Rmd" class="external-link"><code>vignettes/prospective-power.Rmd</code></a></small>
      <div class="d-none name"><code>prospective-power.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://novonordisk-opensource.github.io/postcard/">postcard</a></span><span class="op">)</span></span>
<span><span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_seed.html" class="external-link">local_seed</a></span><span class="op">(</span><span class="fl">1395878</span><span class="op">)</span></span>
<span><span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_options.html" class="external-link">local_options</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>postcard.verbose <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="estimating-the-power-for-marginal-effects">Estimating the power for marginal effects<a class="anchor" aria-label="anchor" href="#estimating-the-power-for-marginal-effects"></a>
</h2>
<p>The method proposed in <a href="https://arxiv.org/abs/2503.22284" class="external-link">Powering RCTs for marginal
effects with GLMs using prognostic score adjustment</a> by
Højbjerre-Frandsen et. al (2025), which can be used to estimate the
power when estimating any marginal effect, is implemented in the
function <code><a href="../reference/power_marginaleffect.html">power_marginaleffect()</a></code>.</p>
<p>An introductory example is available in
<code><a href="../articles/postcard.html">vignette("postcard")</a></code>, but here we describe how to specify
arguments to change the default behavior of the function to align with
assumptions for the power estimation.</p>
<div class="section level4">
<h4 id="simulating-some-data">Simulating some data<a class="anchor" aria-label="anchor" href="#simulating-some-data"></a>
</h4>
<p>We generate count data to showcase the flexibility of
<code><a href="../reference/power_marginaleffect.html">power_marginaleffect()</a></code> that does not assume a linear
model.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_train</span> <span class="op">&lt;-</span> <span class="fl">2000</span></span>
<span><span class="va">n_test</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span><span class="va">b1</span> <span class="op">&lt;-</span> <span class="fl">1.2</span></span>
<span><span class="va">b2</span> <span class="op">&lt;-</span> <span class="fl">2.3</span></span>
<span><span class="va">b3</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">b4</span> <span class="op">&lt;-</span> <span class="fl">1.8</span></span>
<span></span>
<span><span class="va">train_pois</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/glm_data.html">glm_data</a></span><span class="op">(</span></span>
<span>    <span class="va">Y</span> <span class="op">~</span> <span class="va">b1</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">X1</span><span class="op">)</span><span class="op">)</span><span class="op">-</span><span class="va">b2</span><span class="op">*</span><span class="va">X2</span><span class="op">+</span><span class="va">b3</span><span class="op">*</span><span class="va">X3</span><span class="op">-</span><span class="va">b4</span><span class="op">*</span><span class="va">X2</span><span class="op">*</span><span class="va">X3</span>,</span>
<span>    X1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n_train</span>, min <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>, max <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>    X2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_train</span>, mean <span class="op">=</span> <span class="fl">2</span>, sd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>    X3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span><span class="va">n_train</span>, shape <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  Y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">test_pois</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/glm_data.html">glm_data</a></span><span class="op">(</span></span>
<span>    <span class="va">Y</span> <span class="op">~</span> <span class="va">b1</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">X1</span><span class="op">)</span><span class="op">)</span><span class="op">-</span><span class="va">b2</span><span class="op">*</span><span class="va">X2</span><span class="op">+</span><span class="va">b3</span><span class="op">*</span><span class="va">X3</span><span class="op">-</span><span class="va">b4</span><span class="op">*</span><span class="va">X2</span><span class="op">*</span><span class="va">X3</span>,</span>
<span>    X1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n_test</span>, min <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>, max <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>    X2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_test</span>, mean <span class="op">=</span> <span class="fl">2</span>, sd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>    X3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span><span class="va">n_test</span>, shape <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  Y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="controlling-assumptions">Controlling assumptions<a class="anchor" aria-label="anchor" href="#controlling-assumptions"></a>
</h3>
<p>As a default, the variance in group 0 is estimated from the sample
variance of the response, and the variance in group 1 is assumed to be
the same as the estimated variance in group 0. Use argument
<code>var1</code> to change the variance estimate in group 1, either
with a function that modifies the estimate obtained for group 0 or as a
<code>numeric</code>.</p>
<p>The same is true for the MSE, where <code>kappa1_squared</code> as a
default is taken to be the same as the MSE in group 0 unless a
<code>function</code> or <code>numeric</code> is specified.</p>
<p>Below is an example showcasing the specification of <code>var1</code>
and <code>kappa1_squared</code> according to prior beliefs.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lrnr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_best_learner.html">fit_best_learner</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mod <span class="op">=</span> <span class="va">Y</span> <span class="op">~</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span> <span class="op">+</span> <span class="va">X3</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">train_pois</span><span class="op">)</span></span>
<span><span class="va">preds</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">lrnr</span>, new_data <span class="op">=</span> <span class="va">test_pois</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/power_marginaleffect.html">power_marginaleffect</a></span><span class="op">(</span></span>
<span>  response <span class="op">=</span> <span class="va">test_pois</span><span class="op">$</span><span class="va">Y</span>,</span>
<span>  predictions <span class="op">=</span> <span class="va">preds</span>,</span>
<span>  var1 <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">var0</span><span class="op">)</span> <span class="fl">1.2</span> <span class="op">*</span> <span class="va">var0</span>,</span>
<span>  kappa1_squared <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  estimand_fun <span class="op">=</span> <span class="st">"rate_ratio"</span>,</span>
<span>  target_effect <span class="op">=</span> <span class="fl">1.3</span>,</span>
<span>  exposure_prob <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.8377895</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="for-linear-models">For linear models<a class="anchor" aria-label="anchor" href="#for-linear-models"></a>
</h2>
<p>The functions described in the help page <code><a href="../reference/power_linear.html">power_linear()</a></code>
provide utilities for prospective power calculations using linear
models. We conduct sample size calculations by constructing power curves
using a <strong>standard ANCOVA method</strong> as described in
(Guenther WC. Sample Size Formulas for Normal Theory T Tests. The
American Statistician. 1981;35(4):243–244) and (Schouten HJA. Sample
size formula with a continuous outcome for unequal group sizes and
unequal variances. Statistics in Medicine. 1999;18(1):87–91).</p>
<p>We compare the resulting power for ANCOVA models that leverage
prognostic covariate adjustment and ones that don’t. In usual cases of
wanting to conduct sample size/power analyses prospectively, data of the
new exposure is not available at the time of the analysis. What we can
do is use historical data of the comparator group to estimate a variance
and adjust this according to beliefs we might have about data from the
novel group.</p>
<div class="section level4">
<h4 id="simulating-data">Simulating data<a class="anchor" aria-label="anchor" href="#simulating-data"></a>
</h4>
<p>As described above, data is not available at the time of a
prospective power analysis. To showcase a common use case, we here
simulate historical data, which we use to estimate the variance of the
response adjusted by the coefficient of determination with the function
<code><a href="../reference/power_linear.html">variance_ancova()</a></code>.</p>
<blockquote>
<p>To compare power curves between a “standard” ANCOVA model and one
using prognostic covariate adjustment, we simulate historical data, so
we can fit a prognostic model to the training data and use the resulting
model to predict prognostic scores in the test data.</p>
</blockquote>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate some data</span></span>
<span><span class="va">b0</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">b1</span> <span class="op">&lt;-</span> <span class="fl">1.6</span></span>
<span><span class="va">b2</span> <span class="op">&lt;-</span> <span class="fl">1.4</span></span>
<span><span class="va">b3</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">b4</span> <span class="op">&lt;-</span> <span class="fl">0.8</span></span>
<span></span>
<span><span class="va">train</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/glm_data.html">glm_data</a></span><span class="op">(</span></span>
<span>  <span class="va">Y</span> <span class="op">~</span> <span class="va">b0</span><span class="op">+</span><span class="va">b1</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">X1</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="va">b2</span><span class="op">*</span><span class="va">X2</span><span class="op">+</span><span class="va">b3</span><span class="op">*</span><span class="va">X3</span><span class="op">+</span><span class="va">b4</span><span class="op">*</span><span class="va">X2</span><span class="op">*</span><span class="va">X3</span>,</span>
<span>  X1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n_train</span>, min <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>, max <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>  X2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_train</span>, mean <span class="op">=</span> <span class="fl">2</span>, sd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>  X3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n_train</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/glm_data.html">glm_data</a></span><span class="op">(</span></span>
<span>  <span class="va">Y</span> <span class="op">~</span> <span class="va">b0</span><span class="op">+</span><span class="va">b1</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">X1</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="va">b2</span><span class="op">*</span><span class="va">X2</span><span class="op">+</span><span class="va">b3</span><span class="op">*</span><span class="va">X3</span><span class="op">+</span><span class="va">b4</span><span class="op">*</span><span class="va">X2</span><span class="op">*</span><span class="va">X3</span>,</span>
<span>  X1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n_test</span>, min <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>, max <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>  X2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_test</span>, mean <span class="op">=</span> <span class="fl">2</span>, sd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>  X3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n_test</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="fitting-a-prognostic-model">Fitting a prognostic model<a class="anchor" aria-label="anchor" href="#fitting-a-prognostic-model"></a>
</h4>
<p>Using the training part of the historical data, we fit a prognostic
model using the <code><a href="../reference/fit_best_learner.html">fit_best_learner()</a></code> function. This fits a
discrete super learner and returns it as a trained workflow, we can use
for prediction to construct our prognostic scores.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lrnr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_best_learner.html">fit_best_learner</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">train</span>,</span>
<span>  preproc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mod <span class="op">=</span> <span class="va">Y</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span>,</span>
<span>  cv_folds <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  verbose <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="va">test</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">lrnr</span>, <span class="va">test</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="estimating-the-variance-used-for-power-approximation">Estimating the variance used for power approximation<a class="anchor" aria-label="anchor" href="#estimating-the-variance-used-for-power-approximation"></a>
</h3>
<p>We use the function <code>variance_ancova</code> to estimate the
entity
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>σ</mi><mn>2</mn></msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><msup><mi>R</mi><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\sigma^2(1-R^2)</annotation></semantics></math>
in case of a “standard” ANCOVA model adjusting for covariates in data,
and in case of an ANCOVA utilising <strong>prognostic covariate
adjustment</strong> by adjusting for the prognostic score as a
covariate.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">var_bound_ancova</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/power_linear.html">variance_ancova</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span> <span class="op">+</span> <span class="va">X3</span>, data <span class="op">=</span> <span class="va">test</span><span class="op">)</span></span>
<span><span class="va">var_bound_prog</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/power_linear.html">variance_ancova</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span> <span class="op">+</span> <span class="va">X3</span> <span class="op">+</span> <span class="va">.pred</span>, data <span class="op">=</span> <span class="va">test</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="creating-a-plot-of-power-curves">Creating a plot of power curves<a class="anchor" aria-label="anchor" href="#creating-a-plot-of-power-curves"></a>
</h3>
<p>In order to see how the estimated power behaves as a function of the
total sample size, we iterate the <code>power_gs</code> function for a
number of different sample sizes and save the results using both the
estimated variance with and without prognostic covariate adjustment.</p>
<blockquote>
<p>Note we here just use the <code><a href="../reference/power_linear.html">power_gs()</a></code> function, but
<code><a href="../reference/power_linear.html">power_nc()</a></code> is also available and works exactly the same
except it needs an additional mandatory argument <code>df</code> with
degrees of freedom for the t-distribution.</p>
</blockquote>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">desired_power</span> <span class="op">&lt;-</span> <span class="fl">0.9</span></span>
<span><span class="va">n_from</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">n_to</span> <span class="op">&lt;-</span> <span class="fl">250</span></span>
<span></span>
<span><span class="va">iterate_power</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">variance</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">power_ancova</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">n_from</span><span class="op">:</span><span class="va">n_to</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="fu"><a href="../reference/power_linear.html">power_gs</a></span><span class="op">(</span></span>
<span>    n <span class="op">=</span> <span class="va">n</span>,</span>
<span>    variance <span class="op">=</span> <span class="va">variance</span>,</span>
<span>    r <span class="op">=</span> <span class="fl">1</span>, ate <span class="op">=</span> <span class="fl">.8</span>, margin <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n_from</span><span class="op">:</span><span class="va">n_to</span>, power <span class="op">=</span> <span class="va">power_ancova</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">data_power</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="fu">iterate_power</span><span class="op">(</span><span class="va">var_bound_ancova</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      n_desired <span class="op">=</span> <span class="fu"><a href="../reference/power_linear.html">samplesize_gs</a></span><span class="op">(</span></span>
<span>        variance <span class="op">=</span> <span class="va">var_bound_ancova</span>,</span>
<span>        power <span class="op">=</span> <span class="va">desired_power</span>,</span>
<span>        r <span class="op">=</span> <span class="fl">1</span>, ate <span class="op">=</span> <span class="fl">.8</span>, margin <span class="op">=</span> <span class="fl">0</span></span>
<span>      <span class="op">)</span>,</span>
<span>      model <span class="op">=</span> <span class="st">"ancova"</span>,</span>
<span>      model_label <span class="op">=</span> <span class="st">"ANCOVA"</span></span>
<span>    <span class="op">)</span>,</span>
<span>  <span class="fu">iterate_power</span><span class="op">(</span><span class="va">var_bound_prog</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      n_desired <span class="op">=</span> <span class="fu"><a href="../reference/power_linear.html">samplesize_gs</a></span><span class="op">(</span></span>
<span>        variance <span class="op">=</span> <span class="va">var_bound_prog</span>,</span>
<span>        power <span class="op">=</span> <span class="va">desired_power</span>,</span>
<span>        r <span class="op">=</span> <span class="fl">1</span>, ate <span class="op">=</span> <span class="fl">.8</span>, margin <span class="op">=</span> <span class="fl">0</span></span>
<span>      <span class="op">)</span>,</span>
<span>      model <span class="op">=</span> <span class="st">"prog"</span>,</span>
<span>      model_label <span class="op">=</span> <span class="st">"ANCOVA with prognostic score"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We create a plot of the estimated power across values of sample sizes
for the two different models, mark a desired power of 90% as a
horizontal line and create vertical lines with labels that show the
sample size needed to obtain 90% power with each model.</p>
<blockquote>
<p>Note if we were just interested in finding the sample size needed for
90% power, simply running <code><a href="../reference/power_linear.html">samplesize_gs()</a></code> as we do below
would be enough.</p>
</blockquote>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>ancova <span class="op">=</span> <span class="st">"darkorange1"</span>, prog <span class="op">=</span> <span class="st">"dodgerblue4"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">show_npower</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">coords</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">line</span> <span class="op">&lt;-</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/grid.segments.html" class="external-link">segmentsGrob</a></span><span class="op">(</span></span>
<span>    x0 <span class="op">=</span> <span class="va">coords</span><span class="op">$</span><span class="va">x</span>, x1 <span class="op">=</span> <span class="va">coords</span><span class="op">$</span><span class="va">x</span>,</span>
<span>    y0 <span class="op">=</span> <span class="fl">0</span>, y1 <span class="op">=</span> <span class="va">coords</span><span class="op">$</span><span class="va">y</span>,</span>
<span>    gp <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span></span>
<span>      lty <span class="op">=</span> <span class="st">"dashed"</span>,</span>
<span>      col <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">colour</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">group</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">group</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> </span>
<span>    <span class="va">y_pos</span> <span class="op">&lt;-</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="va">coords</span><span class="op">$</span><span class="va">y</span>, <span class="st">"npc"</span><span class="op">)</span> <span class="op">-</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"mm"</span><span class="op">)</span></span>
<span>  <span class="kw">else</span> </span>
<span>    <span class="va">y_pos</span> <span class="op">&lt;-</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.55</span>, <span class="st">"npc"</span><span class="op">)</span></span>
<span>  <span class="va">label</span> <span class="op">&lt;-</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html" class="external-link">textGrob</a></span><span class="op">(</span></span>
<span>    label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">model_label</span>, <span class="st">": "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    x <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="va">coords</span><span class="op">$</span><span class="va">x</span>, <span class="st">"npc"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"mm"</span><span class="op">)</span>,</span>
<span>    y <span class="op">=</span> <span class="va">y_pos</span>,</span>
<span>    just <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    gp <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">colour</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/grid.grob.html" class="external-link">grobTree</a></span><span class="op">(</span><span class="va">line</span>, <span class="va">label</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">data_power</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">n</span>, y <span class="op">=</span> <span class="va">power</span>, color <span class="op">=</span> <span class="va">model</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1.2</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>                     show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span></span>
<span>    yintercept <span class="op">=</span> <span class="va">desired_power</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"grey40"</span>,</span>
<span>    linetype <span class="op">=</span> <span class="st">"dashed"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">gggrid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gggrid/man/grid_panel.html" class="external-link">grid_group</a></span><span class="op">(</span></span>
<span>    <span class="va">show_npower</span>,</span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">n_desired</span>,</span>
<span>                 y <span class="op">=</span> <span class="va">desired_power</span>,</span>
<span>                 model_label <span class="op">=</span> <span class="va">model_label</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">""</span>,</span>
<span>    values <span class="op">=</span> <span class="va">model_cols</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    labels <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span><span class="op">*</span><span class="fl">100</span>, <span class="st">"%"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Total sample size"</span>, y <span class="op">=</span> <span class="st">"Power"</span>,</span>
<span>                title <span class="op">=</span> <span class="st">"Guenther Schouten approximation of power"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span></span>
<span>    face <span class="op">=</span> <span class="st">"bold"</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">16</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="prospective-power_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mathias Lerbech Jeppesen, Emilie Hojbjerre-Frandsen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
